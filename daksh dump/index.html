<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>

    <link rel="stylesheet" type="text/css" href="main.css">

    <script src="./node_modules/web3/dist/web3.min.js"></script>

</head>
<body>
    <div class="container">

        
        <label for="name" class="col-lg-2 control-label">Instructor Name</label>
        <input id="name" type="text">

        <label for="name" class="col-lg-2 control-label">Instructor Age</label>
        <input id="age" type="text">

        <button id="button">Update Instructor</button>


    </div>

    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js"></script>

    <script>
            web3 = new Web3(web3.currentProvider);
        } else {
            // set the provider you want from Web3.providers
            //var Web3 = require('web3');
        var web3 = new Web3(new Web3.providers.HttpProvider('http://localhost:8545'));
        }
        web3.eth.defaultAccount = web3.eth.accounts[0];
        var ElectioncreationContract = new web3.eth.Contract([
	{
		"inputs": [
			{
			},
			{
			},
			{
			},
			{
				"internalType": "uint256",
				"type": "uint256"
			}
		],
		"stateMutability": "nonpayable",
		"type": "constructor"
	},
	{
		"inputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"outputs": [
			{
				"internalType": "address",
				"name": "",
				"type": "address"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [],
		"outputs": [
			{
				"name": "",
			}
		],
		"stateMutability": "view",
		"type": "function"
	}
],'0x99D68B730560ad897E74610c2F04c2060438d851');
//var Electioncreation = ElectioncreationContract.at('[0x645258c69943BDCD313678156a61eB5905FB7ee6]');
        var getJSON = function(url, callback) {
        var xhr = new XMLHttpRequest();
       xhr.open('GET', url, true);
       xhr.responseType = 'json';
       xhr.onload = function() {
      var status = xhr.status;
      if (status === 200) {
        callback(null, xhr.response);
      } else {
        callback(status, xhr.response);
      }
    };
    xhr.send();
};
$.getJSON('http://134.209.146.188:3000/customers',
function(err, data) {
  if (err !== null) {
    alert('Something went wrong: ' + err);
  } else {
    alert('Your query count: ' + data.query.count);
  }
});
console.log(data)*/

let requestURL = 'https://api.codetabs.com/v1/proxy?quest=http://134.209.146.188:3000/customers';
let request = new XMLHttpRequest();
request.open('GET', requestURL);
request.responseType = 'json';
request.send();
request.onload = function() {
  const candidates = request.response;
  console.log(candidates) /// Use this JSON array to load on to the smart contract. 
var o=-1;
  for(i =0; i<candidates.length;i++){
  	if((candidateDistrict.indexOf(candidates[i].district) == -1)){
  		candidateDistrict.push(candidates[i].district)
  		o+=1;
  		candidateParty[o]=[]
		candidateNames[o] = []}
  	

  	candidateNames[o].push(candidates[i].name)
  	
  	candidateParty[o].push(candidates[i].party)
	//candidateNames[i] = candidates[i].name;
	//candidateParty[i] = candidates[i].party;
	//candidateDistrict[i]= candidates[i].district; 
}
console.log(candidateNames)
//for(i=0;i<candidateNames.length;i++)
	//console.log(candidateNames[1][0])

console.log(candidateDistrict)
console.log(candidateParty)



// candidateNames consist of array of arrays of Names of candiates of paticular districts!. 
/*

//get candidates here
     var hours= Endtime-Starttime;                       //calculate hours and start the election along with adding candidates
        $("#button").click(function() {
            Electioncreationcontract.Constructor(candidateNames,candidateParty, candidateDistrict,$("#hours").val());    
		});*/
		//var ballots= Electioncreationcontract.methods.getDeployedBallots().call();
		//put post request here to push ballots in database one by one

		//assuming ballots to be an array of addresses.
	var ballots=["123","456","678"] //comment this out, only for temporary use.
	var jsonToPush=[]
	
	for(i=0;i<ballots.length;i++){
		var jsonObject={}
		jsonObject["district"]=candidateDistrict[i]
		jsonObject["address"]=ballots[i]
		console.log(jsonObject)
		jsonToPush.push(jsonObject)
		}
	console.log(JSON.stringify(jsonToPush))
	let xhr = new XMLHttpRequest(); 
    let url_post = "http://134.209.146.188:3000/contracts"; 
        
            // open a connection 

    //xhr.setRequestHeader("Origin", 'maximum.blog');
    //for(i=0;i<jsonToPush.length;i++){

    xhr.open("POST", url_post, true);
    //xhr.setRequestHeader("Origin", 'maximum.blog');
    xhr.setRequestHeader("Content-Type", "application/json"); 

  	
  		xhr.send(JSON.stringify(jsonToPush)); 	
  		console.log("Sent address")
  	//}


}
var i;
var candidateNames = []
var candidateParty = new Array();
var candidateDistrict= new Array();

    </script>
</body> 
</html> 
